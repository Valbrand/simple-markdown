function getInputSelection(e){var t={start:0,end:0};e.focus();if(typeof e.selectionStart==="number"&&typeof e.selectionEnd==="number"){t.start=e.selectionStart;t.end=e.selectionEnd}else{console.log("Your browser does not currently support 'selectionStart' functionality.");return false}return t}function replaceSelectedText(e){if(typeof e.select==="undefined"){e.select=getInputSelection(e.element)}if(typeof e.replacement==="undefined"){e.replacement=""}var t=e.element.value.substring(0,e.select.start),n=e.element.value.substring(e.select.end,e.element.value.length);e.element.value=t+e.replacement+n;e.element.selectionStart=e.element.selectionEnd=t.length+e.replacement.length}function surroundSelectionWith(e){if(typeof e.select==="undefined"){e.select=getInputSelection(e.element)}if(typeof e.suffix==="undefined"){e.suffix=e.prefix}var t=String(e.prefix),n=String(e.suffix),r=e.element.value.substring(e.select.start,e.select.end);if(typeof e.removeLineBreaks!=="undefined"&&e.removeLineBreaks){r=r.replace(/\n/g,"")}if(e.select){e.element.value=e.element.value.substring(0,e.select.start)+t+r+n+e.element.value.substring(e.select.end,e.element.value.length);if(e.select.start==e.select.end){e.element.selectionStart=e.element.selectionEnd=e.select.start+t.length}else{e.element.selectionStart=e.element.selectionEnd=e.select.end+t.length+n.length}}}function prependLineWith(e,t,n){if(typeof n==="undefined"){n=getInputSelection(e)}var r=e.value.substring(0,n.start),i=e.value.substring(n.start,e.value.length),s=r.lastIndexOf("\n"),o=i.indexOf("\n");n.start=s>=0?s+1:0;n.end=o>=0?r.length+o:e.value.length;surroundSelectionWith({element:e,prefix:t,select:n,suffix:""})}function prependMultipleLinesWith(e,t,n){if(typeof n==="undefined"){n=getInputSelection(e)}var r=e.value.substring(0,n.start).lastIndexOf("\n")+1,i=true,s=e.value.indexOf("\n",r);while(i){surroundSelectionWith({element:e,prefix:t,select:{start:r,end:s<0?e.value.length:s},suffix:""});if(s<0||s>n.end){i=false}else{r=e.selectionStart+1;s=e.value.indexOf("\n",r)}}}function strengthenSelection(e){surroundSelectionWith({element:e,prefix:"**"})}function emphasizeSelection(e){surroundSelectionWith({element:e,prefix:"*"})}function makeTitle(e,t){var n=getInputSelection(e);if(n){if(n.start==n.end){prependLineWith(e,generateHeaderString(t),n)}else{makeTitleFromSelection(e,t,n)}}}function generateHeaderString(e){var t=" ";for(var n=0;n<e;n++){t="#"+t}return t}function makeTitleFromSelection(e,t,n){surroundSelectionWith({element:e,prefix:"\n"+generateHeaderString(t),select:n,suffix:"\n",removeLineBreaks:true})}function makeQuoteBlock(e){var t=getInputSelection(e);if(t){if(t.start==t.end){prependLineWith(e,"> ",t)}else{prependMultipleLinesWith(e,"> ",t)}}}function showHelpText(){text="Browser support:\nThis markdown editor is only supported by browsers that also support the selectionStart and selectionEnd properties of inputs and textareas. If your browser doesn't, and you want to use the widget's buttons to add formatting, please update your browser. You can of course format your text manually, the result will be the same.\n\nAbout line breaks:\nYou can insert line breaks in the resulting text by adding 2 whitespaces before a line break in your markdown text. This will result in a <br> tag.\nNew paragraphs can be creating by inserting two consecutives line breaks in your markdown text, which will cause the closure of the current <p> tag, and the opening of another one.\n\nFor more info (and for an explanation for the rest of Markdown's features), visit \nhttp://daringfireball.net/projects/markdown/syntax\n\nYou can also click 'OK' to open the Markdown Syntax Documentation in another tab/window.";if(window.confirm(text)){if(wndw===null||wndw.closed){wndw=window.open("http://daringfireball.net/projects/markdown/syntax","MarkdownSyntaxDocs")}else{wndw.focus()}}}function makeHorizontalRule(e){var t=getInputSelection(e);if(t){surroundSelectionWith({element:e,select:{start:t.start,end:t.start},prefix:"\n***",suffix:"\n"})}}function makeLink(e){var t=getInputSelection(e);if(t){selectedText=e.value.substring(t.start,t.end);textMask=window.prompt("'Link mask' (the text that will be used as an hyperlink):",selectedText);if(textMask!==null){url=window.prompt("Hyperlink url:","http://");if(url!==null){title=window.prompt("Link title (optional, just press 'Cancel' if you don't want any):","");result="["+textMask+"]"+"("+url;if(title!==null){result+=' "'+title+'"'}result+=")";replaceSelectedText({element:e,select:t,replacement:result})}}}}function makeImage(e){var t=getInputSelection(e);if(t){selectedText=e.value.substring(t.start,t.end);textMask=window.prompt("Alternative text:",selectedText);url=window.prompt("Url for the image:","http://");if(url!==null){if(textMask!==null){title=window.prompt("Image title (optional, just press 'Cancel' if you don't want any):","");result="!["+textMask+"]"+"("+url;if(title!==null){result+=' "'+title+'"'}result+=")"}else{result="<"+url+">"}replaceSelectedText({element:e,select:t,replacement:result})}}}function createMDEditor(e){if(typeof e.input_name==="undefined"){e.input_name="text"}var t={bold:function(e){return function(){strengthenSelection(e)}},italic:function(e){return function(){emphasizeSelection(e)}},h1:function(e){return function(){makeTitle(e,1)}},h2:function(e){return function(){makeTitle(e,2)}},h3:function(e){return function(){makeTitle(e,3)}},h4:function(e){return function(){makeTitle(e,4)}},h5:function(e){return function(){makeTitle(e,5)}},h6:function(e){return function(){makeTitle(e,6)}},quote:function(e){return function(){makeQuoteBlock(e)}},help:function(){return showHelpText},hr:function(e){return function(){makeHorizontalRule(e)}},link:function(e){return function(){makeLink(e)}},img:function(e){return function(){makeImage(e)}}};var n=document.getElementById(e.parent_id),r=["h1","h2","h3","h4","h5","h6","quote","hr","bold","italic","link","img","help"],i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("textarea"),u;s.className="md-editor-buttons";for(var a=0;a<r.length;a++){u=document.createElement("button");u.setAttribute("type","button");u.className="md-editor-button";u.setAttribute("data-md-function",r[a]);u.innerHTML=r[a];s.appendChild(u);u.onclick=t[r[a]](o)}i.className="md-editor";i.appendChild(s);o.setAttribute("name",e.input_name);o.className="md-editor-textarea";i.appendChild(o);if(typeof e.default_style==="undefined"||e.default_style){i.style.display="table";i.style.padding="10px";i.style.backgroundColor="#ccc";i.style.border="1px solid #aaa";o.style.resize="none";o.style.width="100%";if("boxSizing"in i.style){i.style.boxSizing="border-box";o.style.boxSizing="border-box"}else if("MozBoxSizing"in i.style){i.style.MozBoxSizing="border-box";o.style.MozBoxSizing="border-box"}}n.appendChild(i)}var wndw=null